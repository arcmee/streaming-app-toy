# 트위치 클론 백엔드 프로젝트 명세서

## 1. 프로젝트 개요

본 문서는 **클린 아키텍처(Clean Architecture)** 원칙에 기반하여 개발된 트위치 클론 프로젝트 백엔드 시스템의 명세를 기술합니다. 이 프로젝트는 프레임워크, 데이터베이스 등 외부 요인으로부터 독립적인 시스템을 구축하여 높은 테스트 용이성, 유지보수성, 확장성을 확보하는 것을 핵심 목표로 합니다.

---

## 2. 핵심 아키텍처: 클린 아키텍처

모든 소스 코드는 **의존성 규칙(The Dependency Rule)**을 따릅니다. 즉, 의존성 방향은 항상 바깥쪽에서 안쪽으로 향하며, 내부 계층은 외부 계층에 대해 알지 못합니다.

```
        +---------------------------------------------------+
        |            프레임워크 & 드라이버 (Frameworks & Drivers)         |  <-- DB, Express, ORM, 미디어 서버
        |   +-------------------------------------------+   |
        |   |        인터페이스 어댑터 (Interface Adapters)       |   |  <-- 컨트롤러, 리포지토리 구현체
        |   |   +-----------------------------------+   |   |
        |   |   |   애플리케이션 (Application / Use Cases)  |   |   |
        |   |   |   +---------------------------+   |   |   |
        |   |   |   |     도메인 (Domain / Entities)    |   |   |   |
        |   |   |   +---------------------------+   |   |   |
        |   |   +-----------------------------------+   |   |
        |   +-------------------------------------------+   |
        +---------------------------------------------------+
        <-------------------- 의존성 방향 -------------------->
```

-   **도메인 (Domain):** 핵심 비즈니스 로직과 규칙을 포함하며, 외부 의존성이 없는 순수한 계층입니다. (`Entities`, `Repository Interfaces`)
-   **애플리케이션 (Application):** 도메인 데이터를 조율하는 유스케이스를 통해 애플리케이션 특화 비즈니스 로직을 수행합니다. (`Use Cases`)
-   **인프라스트럭처 (Infrastructure):** Express, 데이터베이스 클라이언트, 미디어 서버 어댑터 등 외부 기술을 다루며, 내부 계층의 인터페이스를 구현합니다.

---

## 3. 기술 스택

-   **언어:** TypeScript
-   **웹 프레임워크:** Express.js
-   **컨테이너화:** Docker, Docker Compose
-   **메인 데이터베이스:** PostgreSQL (Prisma ORM 사용)
-   **실시간 채팅:** Socket.IO
-   **미디어 서버:** Node-Media-Server
-   **캐시 & 작업 큐:** Redis (BullMQ 라이브러리 사용)
-   **테스트:** Jest, Supertest

---

## 4. 구현된 기능 목록

### 가. 사용자 및 채널 시스템
-   회원가입 (비밀번호 해싱)
-   로그인 (JWT 기반 인증)
-   채널 정보 조회

### 나. 실시간 방송 및 상태 관리
-   OBS 등 외부 스트리밍 소프트웨어 연동 (RTMP)
-   `Node-Media-Server` 웹훅을 통한 방송 시작/종료 상태 자동 업데이트
-   현재 방송 중인 채널 목록 조회

### 다. 실시간 채팅
-   `Socket.IO`를 이용한 실시간 채팅방 기능
-   채팅 메시지 수신 및 해당 채널에 브로드캐스팅
-   채팅 메시지 데이터베이스 저장

### 라. VOD (방송 다시보기) 시스템
-   **자동 VOD 생성:** 라이브 방송 종료 시, 녹화된 영상 파일을 VOD로 자동 처리하는 작업(Job)을 Redis 큐에 추가
-   **백그라운드 처리:** 별도의 워커(Worker) 프로세스가 큐의 작업을 가져와 `FFmpeg`를 사용하여 비디오 처리 및 메타데이터 저장
-   **VOD 조회:** 채널별 VOD 목록 및 개별 VOD 정보 조회 기능

### 마. VOD 직접 업로드
-   사용자가 녹화된 비디오 파일을 직접 서버에 업로드하여 VOD를 생성하는 기능
-   업로드된 파일은 백그라운드에서 처리되어 VOD로 등록됨

### 바. 자동화된 테스트
-   **단위 테스트 (Unit Test):** 각 유스케이스의 비즈니스 로직을 가상(Fake) 리포지토리를 이용하여 테스트
-   **E2E 테스트 (End-to-End Test):** `Supertest`를 사용하여 실제 API 엔드포인트를 호출, 전체 시스템의 흐름을 통합적으로 검증

---

## 5. 디렉토리 구조

```
/src
├── domain/                     # 도메인 계층 (엔티티, 리포지토리 인터페이스)
├── application/                # 애플리케이션 계층 (유스케이스, DTOs)
├── infrastructure/             # 인프라스트럭처 계층 (웹, DB, 미디어 등)
├── __tests__/                  # 유닛 테스트 (가상 객체)
├── e2e/                        # E2E 테스트
└── main.ts                     # Composition Root: 의존성 주입 설정
```
